<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Offertes</title>
  <style>
    body{font-family:Arial, sans-serif; margin:20px;}
    #list{margin-top:20px;}
    .card{border:1px solid #ccc; border-radius:4px; padding:10px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;}
    .info{flex:1;}
    button{margin-left:8px;}
  </style>
</head>
<body>
  <h1>Offertes</h1>
  <button id="newQuote">Nieuwe offerte maken</button>
  <div id="list"></div>
  <script>
    const listEl=document.getElementById('list');
    document.getElementById('newQuote').addEventListener('click',()=>{
      window.location.href='builder.html';
    });
    function loadDrafts(){
      const drafts=[];
      for(let i=0;i<localStorage.length;i++){
        const key=localStorage.key(i);
        if(key.startsWith('offerte:')){
          try{ drafts.push(JSON.parse(localStorage.getItem(key))); }catch(e){}
        }
      }
      drafts.sort((a,b)=> (b.updated||0)-(a.updated||0));
      listEl.innerHTML='';
      drafts.forEach(d=>{
        const div=document.createElement('div');
        div.className='card';
        const info=document.createElement('div');
        info.className='info';
        const yearly = d.pricing && d.pricing.yearly ? d.pricing.yearly : 0;
        info.innerHTML=`<strong>${d.meta?.companyName||'Onbekend'}</strong><br>Type: ${d.kind||'-'}<br>Onze referentie: ${d.meta?.ourRef||'-'}<br>Prijs per jaar: â‚¬ ${(yearly).toLocaleString('nl-NL',{minimumFractionDigits:2, maximumFractionDigits:2})}`;
        div.appendChild(info);
        const edit=document.createElement('button');
        edit.textContent='Doorgaan/wijzigen';
        edit.addEventListener('click',()=>{ window.location.href='builder.html?id='+d.id; });
        const del=document.createElement('button');
        del.textContent='Verwijderen';
        del.addEventListener('click',()=>{
          if(confirm('Weet je zeker dat je deze offerte wil verwijderen? Deze actie kan niet ongedaan worden gemaakt.')){
            localStorage.removeItem('offerte:'+d.id);
            loadDrafts();
          }
        });
        div.appendChild(edit);
        div.appendChild(del);
        listEl.appendChild(div);
      });
    }
    loadDrafts();
  </script>
</body>
</html>
